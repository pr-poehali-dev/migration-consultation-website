#!/bin/bash

echo "üöÄ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ Telegram –±–æ—Ç–∞"
echo "üìÖ $(date '+%d.%m.%Y %H:%M:%S')"
echo ""

SUCCESS=false

# –ü–æ–ø—ã—Ç–∫–∞ 1: Python
if command -v python3 &> /dev/null; then
    echo "üêç –ü–æ–ø—ã—Ç–∫–∞ 1: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å Python 3"
    echo "====================================="
    if python3 test-telegram.py; then
        SUCCESS=true
        echo "‚úÖ Python —Ç–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
    else
        echo "‚ùå Python —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π"
    fi
    echo ""
fi

# –ü–æ–ø—ã—Ç–∫–∞ 2: Bash/curl (–µ—Å–ª–∏ Python –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª)
if [ "$SUCCESS" = false ] && command -v curl &> /dev/null; then
    echo "üåê –ü–æ–ø—ã—Ç–∫–∞ 2: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å curl"
    echo "==============================="
    if bash curl-telegram-test.sh; then
        SUCCESS=true
        echo "‚úÖ Curl —Ç–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
    else
        echo "‚ùå Curl —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π"
    fi
    echo ""
fi

# –ü–æ–ø—ã—Ç–∫–∞ 3: Bun (–µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏)
if [ "$SUCCESS" = false ] && command -v bun &> /dev/null; then
    echo "üèÉ –ü–æ–ø—ã—Ç–∫–∞ 3: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å Bun"
    echo "============================="
    if bun simple-telegram-test.js; then
        SUCCESS=true
        echo "‚úÖ Bun —Ç–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
    else
        echo "‚ùå Bun —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π"
    fi
    echo ""
fi

# –ü–æ–ø—ã—Ç–∫–∞ 4: Node.js (–µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏)
if [ "$SUCCESS" = false ] && command -v node &> /dev/null; then
    echo "üü¢ –ü–æ–ø—ã—Ç–∫–∞ 4: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å Node.js"
    echo "================================="
    if node test-telegram.js; then
        SUCCESS=true
        echo "‚úÖ Node.js —Ç–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
    else
        echo "‚ùå Node.js —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π"
    fi
    echo ""
fi

# –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
echo "üìä –§–ò–ù–ê–õ–¨–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢"
echo "====================="
if [ "$SUCCESS" = true ]; then
    echo "‚úÖ –¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω!"
    echo "üì± –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram —á–∞—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è"
    exit 0
else
    echo "‚ùå –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–∞ –Ω–µ —É–¥–∞–ª–∏—Å—å"
    echo "üîç –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:"
    echo "   - –ù–∞–ª–∏—á–∏–µ Python 3, curl, bun –∏–ª–∏ Node.js"
    echo "   - –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ"
    echo "   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å URL —Ñ—É–Ω–∫—Ü–∏–∏"
    exit 1
fi